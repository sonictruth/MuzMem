"use strict";angular.module("MuzMemApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/game/:genreId?",{templateUrl:"views/game.html",controller:"GameCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("MuzMemApp").controller("MainCtrl",["$scope","MusicGenres","$location",function(a,b,c){a.selectedGenre=b.getGenres()[0],a.musicGenres=b.getGenres(),a.startGame=function(){c.path("/game/"+a.selectedGenre.id)},console.log(a)}]),angular.module("MuzMemApp").controller("GameCtrl",["$interval","MusicGenres","$scope","$routeParams","$location","TopSongs",function(a,b,c,d,e,f){var g=16,h=Math.sqrt(g),i=null,j=[],k=null,l=null,m=new Audio,n=function(a){for(var b,c,d=a.length;d;b=Math.floor(Math.random()*d),c=a[--d],a[d]=a[b],a[b]=c);return a},o=function(a,b,c,d){this.artist=a,this.title=b,this.img=c,this.sound=d,this.flipped=!1,this.matched=!1};c.genreId=d.genreId,c.genreName="All",c.chosenSongs=[],$("#game-screen").hide(),$("#game-loader").show(),c.loadingStatus="songs info",f.getSongsByGenre(c.genreId).then(function(a){j=[];for(var b=[],d=0;d<a.length;d++){var e=a[d],f=e["im:name"].label,g=e["im:artist"].label,h=e["im:image"][2].label,i=e.link[1].attributes.href,k=$.inArray(h,b)>-1;k||(b.push(h),j.push(new o(g,f,h,i)))}console.log(j),c.startGame()});var p=$.grep(b.genres,function(a){return a.id===c.genreId});1===p.length&&(c.genreName=p[0].name),c.goBack=function(){m.pause(),e.path("/")},c.startGame=function(){$("#game-screen").hide(),$("#game-loader").show();var a=[],b=[];k=null,l=null,c.counter=0,c.cardFlips=0,c.cardsleft=g/2,m.pause(),n(j);for(var d=0;g/2>d;d++){var e=j[d];a.push(e),a.push($.extend({},e))}n(a);for(var f=g,i=function(){f--,0===f&&($("#game-loader").hide(),$("#game-screen").fadeIn(),c.startTimer())},o=0;h>o;o++){b[o]=[];for(var p=0;h>p;p++){var q=a.pop();this.matched=q.flipped=!1,q.audio=new Audio,q.audio.addEventListener("canplaythrough",i,!1),q.audio.src=q.sound,b[o][p]=q}}c.grid=b},c.gameOver=function(){c.currentTitle="Game Over !!!",a.cancel(i)},c.startTimer=function(){a.cancel(i),i=a(function(){c.counter++},1e3),c.clickCard=function(a){a.matched||a===k||a===l||(c.cardFlips=parseInt(c.cardFlips)+1,null===k&&null===l?k=c.flipCard(a):null!==k&&null===l?l=c.flipCard(a):null!==k&&null!==l&&(c.flipCard(k),c.flipCard(l),k=c.flipCard(a),l=null),k.img===l.img&&(k.matched=l.matched=!0,k=l=null,c.cardsleft=parseInt(c.cardsleft)-1,0===parseInt(c.cardsleft)&&c.gameOver()))},c.flipCard=function(a){return m.pause(),a.flipped||(c.currentTitle=a.artist+" -  "+a.title,m=a.audio,m.play()),a.flipped=!a.flipped,a}}}]),angular.module("MuzMemApp").service("MusicGenres",function(){this.genres=[{id:"",name:"all"},{id:"20",name:"alternative"},{id:"29",name:"anime"},{id:"2",name:"blues"},{id:"1122",name:"brazilian"},{id:"4",name:"children'smusic"},{id:"1232",name:"chinese"},{id:"22",name:"christian&gospel"},{id:"5",name:"classical"},{id:"3",name:"comedy"},{id:"6",name:"country"},{id:"17",name:"dance"},{id:"50000063",name:"disney"},{id:"25",name:"easylistening"},{id:"7",name:"electronic"},{id:"28",name:"enka"},{id:"50",name:"fitness&workout"},{id:"50000064",name:"frenchpop"},{id:"50000068",name:"germanfolk"},{id:"50000066",name:"germanpop"},{id:"18",name:"hip-hop/rap"},{id:"8",name:"holiday"},{id:"1262",name:"indian"},{id:"53",name:"instrumental"},{id:"27",name:"j-pop"},{id:"11",name:"jazz"},{id:"51",name:"k-pop"},{id:"52",name:"karaoke"},{id:"30",name:"kayokyoku"},{id:"1243",name:"korean"},{id:"12",name:"latino"},{id:"13",name:"newage"},{id:"9",name:"opera"},{id:"14",name:"pop"},{id:"15",name:"r&b/soul"},{id:"24",name:"reggae"},{id:"21",name:"rock"},{id:"10",name:"singer/songwriter"},{id:"16",name:"soundtrack"},{id:"50000061",name:"spokenword"},{id:"23",name:"vocal"},{id:"19",name:"world"}],this.getGenres=function(){return this.genres}}),angular.module("MuzMemApp").factory("TopSongs",["$http","$q",function(a,b){var c={};return c.getSongsByGenre=function(c){var d=b.defer(),e="";""!==c&&(e="/genre="+c);var f="https://itunes.apple.com/us/rss/topsongs/limit=100"+e+"/explicit=true/json";return a({url:f,method:"GET"}).success(function(a){var b=a.feed.entry;d.resolve(b)}).error(function(){d.reject("HTTP Error")}),d.promise},c}]);